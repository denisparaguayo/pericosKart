---
import MainLayout from '../layouts/MainLayout.astro';
import {
	drivers,
	races,
	getLastRace,
	getOverallFastestLap,
	getDriverById,
} from '../lib/data';

const lastRace = getLastRace();
const globalFastest = getOverallFastestLap();
---

<MainLayout
	title="Pericos ¬∑ Kart"
	description="Liga amateur de karting entre amigos. La pole es buena‚Ä¶ pero la amistad es mejor."
	image="/pericos.jpg"
	path="/">
	<section class="mb-10 grid gap-8 lg:grid-cols-[3fr,2fr]">
		{/* HERO */}
		<div>
			<p
				class="mb-3 inline-flex items-center rounded-full border border-fuchsia-500/70 bg-fuchsia-500/10 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.2em] text-fuchsia-300">
				Pilotos ¬∑ Multi-equipo
			</p>
			<h1 class="text-3xl font-semibold tracking-tight sm:text-4xl lg:text-5xl">
				La pole es buena‚Ä¶ pero
				<span
					class="bg-gradient-to-r from-fuchsia-400 via-purple-400 to-sky-400 bg-clip-text text-transparent">
					la amistad es mejor.
				</span> üèÅüíúüèéÔ∏è
			</h1>
			<p class="mt-4 max-w-xl text-sm text-slate-300 sm:text-base">
				Somos un grupo de pilotos de karting amateur de diferentes equipos. Esta
				es nuestra central de tiempos, podios, fotos y estad√≠sticas.
			</p>

			{
				lastRace && (
					<div class="mt-6 grid gap-4 sm:grid-cols-2">
						{/* √öltima fecha */}
						<div class="rounded-xl border border-slate-800 bg-[#0b0b19] p-4 shadow-lg">
							<p class="text-[11px] font-semibold uppercase tracking-[0.22em] text-slate-400">
								√öltima fecha
							</p>
							<p class="mt-1 text-sm font-medium">
								Ronda {lastRace.round} ¬∑ {lastRace.track}
							</p>
							<p class="text-xs text-slate-400">
								{new Date(lastRace.date).toLocaleDateString('es-PY', {
									day: '2-digit',
									month: 'short',
									year: 'numeric',
								})}
							</p>
							<div class="mt-3 space-y-2 text-xs">
								<p class="font-semibold text-slate-300">Podio:</p>
								<ul class="space-y-1">
									{lastRace.podium.map((p) => {
										const d = getDriverById(p.driverId);
										if (!d) return null;
										return (
											<li class="flex items-center justify-between">
												<span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-800 text-[10px] font-bold">
													{p.position}
												</span>
												<span class="mx-2 flex-1 truncate text-xs">
													{d.name}
												</span>
												<span class="text-[10px] text-slate-400">
													#{d.number}
												</span>
											</li>
										);
									})}
								</ul>
							</div>
						</div>

						{/* FASTEST LAP GLOBAL - MORADO */}
						{globalFastest && (
							<div class="relative overflow-hidden rounded-xl border border-purple-500/80 bg-gradient-to-br from-purple-900/60 via-fuchsia-900/40 to-slate-900 p-[1px] shadow-[0_0_28px_rgba(168,85,247,0.35)]">
								<div class="h-full w-full rounded-[11px] bg-[#080513]/95 p-4">
									<p class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-[0.26em] text-purple-300">
										<span class="inline-flex h-2 w-2 animate-pulse rounded-full bg-purple-400" />
										Fastest Lap
									</p>
									<p class="mt-2 text-sm font-semibold text-slate-50">
										{globalFastest.driver.name}
										<span class="ml-2 text-[11px] text-slate-400">
											#{globalFastest.driver.number} ¬∑{' '}
											{globalFastest.driver.team}
										</span>
									</p>
									<p class="mt-1 text-2xl font-mono font-semibold text-purple-300">
										{globalFastest.time}
									</p>
									<p class="mt-1 text-xs text-slate-400">
										Lograda en ronda {globalFastest.race.round} ¬∑{' '}
										{globalFastest.race.track}
									</p>
								</div>
							</div>
						)}
					</div>
				)
			}
		</div>

		{/* Panel lateral: CTA + mini stats */}
		<div class="space-y-4">
			<div class="rounded-xl border border-slate-800 bg-[#0b0b19] p-4 text-sm">
				<p
					class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
					Info r√°pida
				</p>
				<p class="mt-2 text-sm text-slate-200">
					Pilotos activos:{' '}
					<span class="font-semibold text-fuchsia-300">
						{drivers.length}
					</span>
				</p>
				{
					races.length > 0 && (
						<p class="text-sm text-slate-200">
							Fechas disputadas:{' '}
							<span class="font-semibold text-fuchsia-300">4</span>
						</p>
					)
				}
				<p class="mt-3 text-xs text-slate-400">
					Pr√≥ximo objetivo: bajar una d√©cima m√°s en tu mejor lap.
				</p>
			</div>

			<a
				href="/galeria"
				class="flex items-center justify-between rounded-xl border border-slate-800 bg-gradient-to-r from-slate-900 via-slate-900 to-slate-950 px-4 py-3 text-sm hover:border-fuchsia-500/70 hover:shadow-[0_0_18px_rgba(251,113,133,0.3)] transition">
				<div>
					<p
						class="text-xs font-semibold uppercase tracking-[0.25em] text-slate-400">
						Galer√≠a
					</p>
					<p class="text-sm text-slate-100">Mir√° las mejores fotos de pista</p>
				</div>
				<span class="text-lg">üèÅ</span>
			</a>
		</div>
	</section>

	{/* GRID DE PILOTOS */}
	<section id="pilotos" class="mt-6">
		<div class="mb-4 flex items-end justify-between gap-3">
			<div>
				<h2 class="text-lg font-semibold tracking-tight sm:text-xl">Pilotos</h2>
				<p class="text-xs text-slate-400 sm:text-sm">
					Cada uno con su propio equipo, pero todos buscando la vuelta perfecta.
				</p>
			</div>
			<a
				href="/resultados"
				class="hidden text-xs font-medium text-fuchsia-300 hover:text-fuchsia-200 sm:inline-flex">
				Ver resultados ‚Üí
			</a>
		</div>

		<div class="grid gap-4 sm:grid-cols-2 md:grid-cols-3">
			{
				drivers.map((d) => (
					<a
						href={`/pilotos/${d.id}`}
						class="group flex flex-col overflow-hidden rounded-xl border border-slate-800 bg-[#0b0b19] hover:border-fuchsia-500/70 hover:bg-slate-900/80 transition">
						{d.photo && (
							<div class="aspect-[16/10] overflow-hidden">
								<img
									src={d.photo}
									alt={d.name}
									class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
									loading="lazy"
								/>
							</div>
						)}
						<div class="flex flex-1 flex-col gap-1 px-3 py-3">
							<div class="flex items-center justify-between text-xs text-slate-400">
								<span class="inline-flex items-center gap-1">
									<span class="h-2 w-2 rounded-full bg-emerald-500" />
									{d.team}
								</span>
								<span class="font-mono text-[11px] text-slate-500">
									#{d.number}
								</span>
							</div>
							<p class="text-sm font-semibold text-slate-100">{d.name}</p>
							{d.city && (
								<p class="text-[11px] text-slate-400">
									{d.city} ¬∑ {d.country}
								</p>
							)}
							{d.helmetColor && (
								<p class="mt-1 line-clamp-2 text-[11px] text-slate-400">
									Casco: {d.helmetColor}
								</p>
							)}
						</div>
					</a>
				))
			}
		</div>
	</section>
</MainLayout>
